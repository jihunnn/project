<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mypage">

	<resultMap id="myOrderInfoResult" type="MypageVO">
		<result property="memOrderSeqNum" column="memOrderSeqNum" />
		<result property="memOrderNum" column="memOrderNum" />
		<result property="memId" column="memId" />
		<result property="productNum" column="productNum" />
		<result property="memSpName" column="memSpName" />
		<result property="memSpPhoneNum1" column="memSpPhoneNum1" />
		<result property="memSpPhoneNum2" column="memSpPhoneNum2" />
		<result property="memSpAdr" column="memSpAdr" />
		<result property="memOrderMsg" column="memOrderMsg" />
		<result property="memDepositorName" column="memDepositorName" />
		<result property="memPaymentMethod" column="memPaymentMethod" />
		<result property="totalPrice" column="totalPrice" />
		<result property="memOrderDate" column="memOrderDate" />
		<result property="productCnt" column="productCnt" />
		<result property="productImage" column="productImage" />
		<result property="purchaseConfirm" column="purchaseConfirm" />
	</resultMap>

	<resultMap id="mypageReturnResult" type="MypageVO">
		<result property="returnNum" column="returnNum" />
		<result property="memOrderSeqNum" column="memOrderSeqNum" />
		<result property="returnType" column="returnType" />
		<result property="returnContent" column="returnContent" />
		<result property="cuttentStatus" column="cuttentStatus" />
	</resultMap>

	<!--마이페이지 주문/배송조회 -->
	<select id="selectAllMyOrderInfoList"
		resultMap="myOrderInfoResult">
	<![CDATA[
			
		select memOrderNum, memOrderDate, purchaseConfirm, o.memOrderSeqNum, productCnt, option1, p.productImage,p.productPrice, p.productName, p.productNum, d.deliveryStatus 
		from memberOrder as o left join product as p on o.productNum=p.productNum 
		join memdelivery as d on o.memOrderSeqNum=d.memOrderSeqNum  where o.memId=#{memId} order by memOrderDate desc
		limit #{pageStart}, #{perPageNum};
			
	]]>
	</select>
	<select id="selectMyOrderInfoCount" resultType="int"
		parameterType="int">
	<![CDATA[
			
			select count(*)  from memberOrder where memId=#{memId};
			
	]]>
	</select>

	<update id="updatePurchaseConfirm" parameterType="String">
		update
		memberOrder
		set purchaseConfirm = '구매확정' where
		memOrderSeqNum = list
		#{memOrderSeqNum};
	</update>

	<insert id="insertNewReview" parameterType="java.util.Map">
		<![CDATA[
			insert into productReview(memId,productNum, memOrderSeqNum,productReviewTitle, productContent, reviewFile)
			values(#{memId},#{productNum}, #{memOrderSeqNum}, #{productReviewTitle},  #{productContent}, #{reviewFile});
		]]>

	</insert>

	<select id="selectNewReviewNum" resultType="int">
	<![CDATA[
			
			select max(reviewNum)+1 from productReview;
	

	]]>
	</select>
	
		<select id="selectAllMypageReturnList"
		resultMap="mypageReturnResult">
	<![CDATA[
			
		select returnNum, memOrderSeqNum, returnType, returnContent, currentStatus,  o.productCnt, o.option1, o.productImage,o.productPrice, p.productName, o.productNum
		from returnhistory as r left join memberOrder as o on r.memOrderSeqNum=p.memOrderSeqNum 
		join product as p on r.productNum=p.productNum  where o.memId=#{memId} order by memOrderDate desc
		limit #{pageStart}, #{perPageNum};
			
	]]>
	</select>
	<select id="selectMypageReturnCount" resultType="int"
		parameterType="int">
	<![CDATA[
			
			select count(*)  from memberOrder where memId=#{memId};
			
	]]>
	</select>
	
	
	<insert id="insertNewReturn" parameterType="java.util.Map">
		<![CDATA[
			insert into returnhistory(memOrderSeqNum,returnType, returnContent,currentStatus)
			values(#{memOrderSeqNum},#{returnType}, #{returnContent}, #{productReviewTitle},  #{productContent}, #{reviewFile});
		]]>

	</insert>
	


</mapper>